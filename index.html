<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALACDANS</title>
    <style>
        html, body {
            max-width: 100vw;
            overflow-x: hidden;
        }
        body {
            font-size: 16px;
        }
        .container {
            display: flex;
            flex-direction: row;
        }
        .sidebar {
            min-width: 220px;
            max-width: 260px;
        }
        .main-content {
            flex: 1;
            min-width: 0;
        }
        /* Responsive styles */
        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                min-width: 0;
                max-width: 100vw;
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                border-radius: 0 0 18px 18px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            }
            .sidebar ul {
                display: flex;
                flex-direction: row;
                width: 100%;
                justify-content: space-around;
                align-items: center;
                margin: 0;
                padding: 0;
            }
            .sidebar li {
                margin: 0 8px;
            }
            .main-content {
                padding: 0 4vw;
            }
        }
        @media (max-width: 700px) {
            body {
                font-size: 15px;
            }
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100vw;
                min-width: 0;
                max-width: 100vw;
                border-radius: 0 0 18px 18px;
            }
            .main-content {
                padding: 0 2vw;
            }
            .logo {
                width: 90px !important;
                height: auto !important;
            }
            .home-search-center, .home-search-row, .login-main, .login-box {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            .home-search-row > .field {
                width: 100% !important;
                margin-bottom: 12px !important;
            }
            .main-content img {
                max-width: 100vw !important;
                height: auto !important;
            }
            #dashboard-gauges {
                flex-direction: column !important;
                gap: 24px !important;
                align-items: stretch !important;
            }
            #dashboard-gauges > div {
                min-width: 0 !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
        }
        @media (max-width: 500px) {
            body {
                font-size: 14px;
            }
            .sidebar {
                font-size: 0.95em;
            }
            .main-content {
                padding: 0 1vw;
            }
            .logo {
                width: 60px !important;
            }
            #dashboard-gauges > div {
                padding: 18px 6px !important;
            }
        }
        /* Show monitor controls only on hover */
        .monitor-controls button {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        .monitor-controls:hover button {
            opacity: 1;
            pointer-events: auto;
        }
        /* Ensure layout renders at 100% zoom */
        html {
            zoom: 100%;
        }
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f8fff8;
        }
        /* logo styling for Home tab */
        .logo {
            max-width: 320px;
            width: 100%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 32px;
        }
        /* Home search: place and city side-by-side, larger and rounded */
        .home-search-row {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            flex-wrap: wrap; /* stack on small screens */
        }
        .home-search-row .field {
            display: flex;
            flex-direction: column;
        }
        .home-search-row label {
            margin-bottom: 6px;
            font-weight: bold;
        }
        .home-search-row select {
            padding: 12px 18px;       /* make selects bigger */
            border-radius: 24px;     /* round the sides */
            font-size: 1.05em;
            border: 1px solid #ccc;
            background: #fff;
        }
        /* widths: Place larger, City smaller and to the right */
        .home-search-row .place {
            width: 360px;
        }
        .home-search-row .city {
            width: 220px;
        }
        .header {
            background-color: #819171;
            color: white;
            padding: 16px;
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-right {
            display: flex;
            align-items: center;
        }
    .search-box {
        /* Header search results background color */
        #header-search-results {
            background: #e8e4c9 !important;
            color: #000000;
        }
            background-color: #e8e4c9; /* light green */
            border: none;
            border-radius: 20px;
            padding: 4px 12px;
            margin-left: 20px;
            display: flex;
            align-items: center;
            width: 300px; /* increased from 240px to make the search bar a bit longer */
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 12px;
            object-fit: cover;
            cursor: pointer;
        }
        .search-box input {
            border: none;
            outline: none;
            padding: 6px 10px;
            border-radius: 20px;
            width: 100%;
            background: transparent;
            font-size: 1em;
        }
        .container {
            display: flex;
        }
        .sidebar {
            background-color: #BBB4B4; /* gray */
            width: 220px;
            min-height: 100vh;
            padding-top: 24px;
            box-sizing: border-box;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        /* make sidebar links look like the list items and open in new tabs */
        .sidebar a {
            color: inherit;
            text-decoration: none;
            display: block;
            width: 100%;
        }
        .sidebar a:focus, .sidebar a:hover {
            outline: none;
            background-color: #AFA7A7;
        }
        /* active sidebar link */
        .sidebar a.active {
            background-color: #AFA7A7;
        }
        /* tab content: hide by default, show when .active */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .sidebar li {
            padding: 16px 24px;
            font-size: 1.1em;
            color: #333;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: bold; /* Added to make sidebar items bold */
        }
        .sidebar li:hover {
            background-color: #BBB4B4;
        }
        .main-content {
            flex: 1;
            padding: 32px;
        }
        /* Footer uses same background color as the header only (no header items copied) */
        .footer {
            background-color: #819171;
            color: white;
            padding: 12px 16px;
            text-align: center;
            font-weight: normal;
        }
        /* Dashboard specific styles */
        .dashboard-boxes {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
            width: 100%;
        }
        .dashboard-box {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 16px;
            flex: 1;
            margin: 0 8px;
            text-align: center;
            font-weight: bold;
            min-height: 340px; /* Increased height */
            height: 340px;     /* Ensures all boxes are much taller */
        }
        @media (max-width: 900px) {
            .dashboard-boxes {
                flex-direction: column;
                gap: 16px;
            }
            .dashboard-box {
                margin: 0 0 16px 0;
                height: 220px;
                min-height: 220px;
            }
        }
        /* Monitoring specific styles */
        .monitoring-huge-box {
            width: 100%;
            height: 480px;
            background: #e0eaff;
            border-radius: 18px;
            border: 1.5px solid #b0b8c9;
            margin-top: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
        }
        @media (max-width: 900px) {
            .monitoring-huge-box {
                height: 260px;
            }
        }
        /* History specific styles */
        .history-huge-box {
            width: 100%;
            height: 480px;
            background: #fff6e0;
            border-radius: 18px;
            border: 1.5px solid #e0c9b0;
            margin-top: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .history-log {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            max-height: 432px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .history-entry {
            background: #fff;
            border-radius: 10px;
            padding: 16px 20px;
            font-size: 1.15em;
            color: #333;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            border-left: 5px solid #e0c9b0;
        }
        /* Centered and bigger search form */
        .home-search-center {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
        }
        .big-search-btn {
            padding: 12px 24px;
            border-radius: 24px;
            background: #819171;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 12px;
            width: 100%;
            max-width: 400px;
        }
        /* Login specific styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .login-header {
            background-color: #819171;
            color: white;
            padding: 24px 0 16px 0;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            letter-spacing: 2px;
        }
        .login-main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .login-box {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
            padding: 48px 40px 36px 40px;
            min-width: 380px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .login-logo {
            max-width: 160px;
            margin-bottom: 24px;
        }
        .login-form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 22px;
        }
        .login-form label {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        .login-form input[type="text"],
        .login-form input[type="password"] {
            padding: 14px 18px;
            border-radius: 24px;
            border: 1.5px solid #ccc;
            font-size: 1.1em;
            background: #f8fff8;
            outline: none;
            transition: border 0.2s;
        }
        .login-form input:focus {
            border: 1.5px solid green;
        }
        .login-btn {
            padding: 14px 0;
            border-radius: 24px;
            background: #819171;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1.15em;
            font-weight: bold;
            margin-top: 8px;
            width: 100%;
            transition: background 0.2s;
        }
        .login-btn:hover {
            background: #006400;
        }
        .login-error {
            color: #b00;
            background: #ffeaea;
            border-radius: 12px;
            padding: 10px 0;
            margin-bottom: 8px;
            text-align: center;
            font-size: 1em;
            display: none;
        }
        @media (max-width: 600px) {
            .login-box { min-width: 90vw; padding: 24px 8vw; }
        }

        /* Responsive: Mobile-first improvements */
        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                min-height: unset;
                padding-top: 8px;
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                position: sticky;
                top: 0;
                z-index: 10;
            }
            .sidebar ul {
                display: flex;
                flex-direction: row;
                width: 100%;
                justify-content: space-around;
            }
            .sidebar li {
                padding: 12px 10px;
                font-size: 1em;
                min-width: 90px;
                text-align: center;
            }
            .main-content {
                padding: 16px 4vw;
            }
            .header {
                flex-direction: column;
                align-items: flex-start;
                font-size: 1.1em;
                padding: 12px 8px;
            }
            .header-right {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-start;
            }
            .search-box {
                width: 100%;
                min-width: 0;
                margin-left: 0;
                margin-bottom: 8px;
            }
            .avatar {
                margin-left: 0;
            }
            .logo {
                max-width: 110px;
                margin-bottom: 12px;
            }
            .home-search-row {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }
            .home-search-row .place,
            .home-search-row .city {
                width: 100%;
            }
            .home-search-center {
                width: 100%;
            }
            .big-search-btn {
                max-width: 100%;
            }
            /* Images in Home tab */
            #home > div {
                flex-direction: column !important;
                align-items: center !important;
            }
            #home img[alt="Manhole"] {
                max-width: 100vw;
                width: 100%;
                height: 180px;
                margin-left: 0 !important;
                margin-top: 18px;
            }
            #home img[alt="Baha"] {
                width: 100vw;
                height: 120px;
                margin-top: 12px !important;
            }
            .dashboard-boxes {
                flex-direction: column;
                gap: 12px;
            }
            .dashboard-box {
                margin: 0 0 12px 0;
                height: 160px;
                min-height: 120px;
            }
            .monitoring-huge-box,
            .history-huge-box {
                height: 180px;
                min-height: 120px;
                padding: 0;
            }
            .history-log {
                padding: 10px;
                max-height: 140px;
                font-size: 0.95em;
            }
            .history-entry {
                padding: 10px 12px;
                font-size: 1em;
            }
            .login-box {
                min-width: 90vw;
                padding: 18px 2vw;
            }
            .login-header {
                font-size: 1.3em;
                padding: 14px 0 8px 0;
            }
            .login-logo {
                max-width: 90px;
                margin-bottom: 12px;
            }
            .footer {
                font-size: 0.95em;
                padding: 8px 4px;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .main-content {
                padding: 8px 2vw;
            }
            .sidebar li {
                font-size: 0.95em;
                padding: 8px 4px;
                min-width: 70px;
            }
            .login-box {
                min-width: 98vw;
                padding: 8px 1vw;
            }
            .login-header {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="login-container" id="login-interface">
        <div class="login-header">ALACDANS</div>
        <div class="login-main">
            <div class="login-box">
                <img src="Image/logo.jpg" alt="ALACDANS logo" class="login-logo">
                <form class="login-form" id="login-form" autocomplete="off">
                    <div>
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required autocomplete="off" autofocus>
                    </div>
                    <div>
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required autocomplete="off">
                    </div>
                    <div class="login-error" id="login-error">Invalid username or password.</div>
                    <button type="submit" class="login-btn">Login</button>
                </form>
            </div>
        </div>
    </div>
    <div id="main-interface" style="display:none;">
        <div class="header">
            ALACDANS
            <div class="header-right">
                <div class="search-box" style="position:relative;">
                    <input type="text" id="header-search" placeholder="" autocomplete="off">
                    <button id="header-search-exit" style="display:none; position:absolute; right:6px; top:6px; background:#bbb; color:#222; border:none; border-radius:50%; width:26px; height:26px; font-size:1.1em; cursor:pointer;">&times;</button>
                    <div id="header-search-results" style="display:none; position:absolute; top:38px; left:0; width:100%; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.13); z-index:2000; max-height:220px; overflow-y:auto;"></div>
                </div>
                <img class="avatar" src="Image/account.jpg" alt="Account" id="avatar-account" tabindex="0" style="position:relative;">
                <div id="account-menu" style="display:none; position:absolute; top:60px; right:16px; background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.12); z-index:1000; min-width:120px;">
                    <button id="signout-btn" style="width:100%; padding:12px 0; border:none; background:none; font-size:1em; cursor:pointer; color:#333; border-radius:12px;">Sign out</button>
                </div>
            </div>
        </div>
        <div class="container">
            <nav class="sidebar" role="navigation" aria-label="Main">
                <ul>
                    <li><a href="#" data-target="home" class="active">Home</a></li>
                    <li><a href="#" data-target="dashboard">Dashboard</a></li>
                    <li><a href="#" data-target="monitoring">Monitoring System</a></li>
                    <li><a href="#" data-target="history">History</a></li>
                    <li><a href="#" data-target="about">About</a></li>
                </ul>
            </nav>
            <div class="main-content">
                <section id="home" class="tab-content active" aria-hidden="false">
                    <div style="display: flex; align-items: flex-start; justify-content: space-between;">
                        <div>
                            <img src="Image/logo.jpg" alt="ALACDANS logo" class="logo">
                            <!-- Centered and bigger search form -->
                            <div class="home-search-center">
                                <form id="home-search" aria-label="Search Places and City">
                                    <div class="home-search-row">
                                        <div class="field city">
                                            <label for="city-select">City</label>
                                            <select id="city-select" name="city">
                                                <option value="">-- Select City --</option>
                                                <option value="mandaluyong">Mandaluyong City</option>
                                                <option value="pasig">Pasig City</option>
                                            </select>
                                        </div>
                                        <div class="field place">
                                            <label for="place-select">Place</label>
                                            <select id="place-select" name="place">
                                                <option value="">-- Select Place --</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style="margin-top:18px; text-align:center;">
                                        <button type="button" id="search-btn" class="big-search-btn">
                                            Search
                                        </button>
                                    </div>
                                </form>
                                <!-- QUOTE AND DESCRIPTION START -->
                                <div style="margin-top: 36px; margin-bottom: 32px; width: 100%; display: flex; flex-direction: column; align-items: center;">
                                    <div style="font-size: 2.1em; font-weight: bold; color: #006400; letter-spacing: 2.5px; margin-bottom: 18px; text-transform: uppercase; text-align:center; line-height: 1.15;">
                                        "PRY BENEATH, STOP THE THREAT"
                                    </div>
                                </div>
                                <!-- QUOTE AND DESCRIPTION END -->
                            </div>
                            <!-- Move the description lower, outside of .home-search-center -->
                            <div style="margin-top: 60px; margin-bottom: 32px; width: 100%; display: flex; flex-direction: column; align-items: center;">
                                <div style="font-size: 1.35em; color: #222; max-width: 800px; margin: 0 auto; text-align:justify; line-height: 1.5;">
                                    ALACDANS is designed to provide real-time detection and reporting of abnormalities in urban sewer and drainage networks. Using integrated sensors and automated alert technology, the system monitors water levels, flow conditions, and potential blockages. When clogging, overflow, or unusual activity is detected, the system immediately sends notifications to concerned authorities for quick response.
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end;">
                            <img src="Image/manhole.jpg" alt="Manhole" style="max-width: 700px; width: 100%; height: 400px; border-radius: 18px; margin-left: 32px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); border: 4px solid #959279;">
                            <img src="Image/baha.jpg" alt="Baha" style="margin-top: 24px; width: 340px; height: 260px; object-fit: cover; border-radius: 18px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); border: 4px solid #959279;">
                        </div>
                    </div>
                </section>
                <section id="dashboard" class="tab-content" aria-hidden="true">
                    <img src="Image/logo.jpg" alt="ALACDANS logo" class="logo">
                    <h2>Dashboard</h2>
                    <div id="dashboard-gauges" style="display: flex; gap: 48px; justify-content: center; align-items: flex-start; margin-top: 32px; flex-wrap: wrap;">
                        <!-- Lidar Gauge -->
                        <div style="background: #fff; border-radius: 18px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); padding: 32px 36px; display: flex; flex-direction: column; align-items: center; min-width: 320px; margin-bottom: 24px;">
                            <h3 style="margin-bottom: 18px; color: #222;">Lidar Reading</h3>
                            <svg width="180" height="110" viewBox="0 0 180 110">
                                <path d="M20,90 A70,70 0 0,1 160,90" stroke="#eee" stroke-width="18" fill="none"/>
                                <path id="lidar-gauge-bar" d="M20,90 A70,70 0 0,1 20,90" stroke="#4caf50" stroke-width="18" fill="none"/>
                                <circle cx="90" cy="90" r="12" fill="#4caf50"/>
                            </svg>
                            <div id="lidar-gauge-value" style="font-size: 2.2em; font-weight: bold; color: #222; margin-top: 12px;">-- cm</div>
                            <div style="font-size: 1.1em; color: #666; margin-top: 4px;">VL53L0X Lidar</div>
                        </div>
                        <!-- Ultrasonic Gauge -->
                        <div style="background: #fff; border-radius: 18px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); padding: 32px 36px; display: flex; flex-direction: column; align-items: center; min-width: 320px; margin-bottom: 24px;">
                            <h3 style="margin-bottom: 18px; color: #222;">Ultrasonic Reading</h3>
                            <svg width="180" height="110" viewBox="0 0 180 110">
                                <path d="M20,90 A70,70 0 0,1 160,90" stroke="#eee" stroke-width="18" fill="none"/>
                                <path id="ultrasonic-gauge-bar" d="M20,90 A70,70 0 0,1 20,90" stroke="#2196f3" stroke-width="18" fill="none"/>
                                <circle cx="90" cy="90" r="12" fill="#2196f3"/>
                            </svg>
                            <div id="ultrasonic-gauge-value" style="font-size: 2.2em; font-weight: bold; color: #222; margin-top: 12px;">-- cm</div>
                            <div style="font-size: 1.1em; color: #666; margin-top: 4px;">JSN-SR04T Ultrasonic</div>
                            <div id="ultrasonic-level-indicator" style="margin-top: 16px; font-size: 1.15em; font-weight: 600; color: #0d47a1; background: #e8f0fb; border-radius: 10px; padding: 6px 18px;">Level: --</div>
                        </div>
                    </div>
                    <div id="device-status-indicator" style="margin-top:18px; text-align:center;">
                        <!-- Status will appear here -->
                    </div>
                </section>
                <section id="monitoring" class="tab-content" aria-hidden="true">
                    <img src="Image/logo.jpg" alt="ALACDANS logo" class="logo">
                    <h2>Monitoring System</h2>
                    <div class="monitoring-huge-box" style="display: flex; gap: 24px; height: 480px;">
                        <!-- Camera Box: Only show the latest Firebase image, no stream or button -->
                        <div id="camera-refresh-box" style="flex:1; background:#fff; border-radius:18px; box-shadow:0 2px 12px rgba(0,0,0,0.07); border:1.5px solid #b0b8c9; display:flex; flex-direction:column; align-items:center; justify-content:center; min-width:340px; padding:24px 0; cursor:pointer;" title="Click to refresh image">
                            <h3 style="margin-bottom: 18px; color:#222;">Latest Camera Image</h3>
                            <img id="latest-firebase-image" alt="Latest Firebase Image" style="width:320px; height:240px; border-radius:12px; border:2px solid #388e3c; object-fit:cover; background:#eee;">
                            <div id="image-status" style="margin-top:12px; font-size:1em; color:#888;">Loading image...</div>
                        </div>
                        <!-- Google Map Box -->
                        <div style="flex:2; background:#e0eaff; border-radius:18px; box-shadow:0 2px 12px rgba(0,0,0,0.07); border:1.5px solid #b0b8c9; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                            <h3 style="margin-bottom: 12px; color:#222;">Location Map</h3>
                            <div id="monitoring-map" style="width:95%; height:340px; border-radius:12px; overflow:hidden; box-shadow:0 1px 8px rgba(0,0,0,0.10);">
                                <!-- Google Map iframe placeholder -->
                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3874.007234234234!2d121.045!3d14.579!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTTCsDM0JzQ0LjAiTiAxMjHCsDAyJzQyLjAiRQ!5e0!3m2!1sen!2sph!4v1660000000000!5m2!1sen!2sph" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                            </div>
                            <span style="font-size:0.95em; color:#555; margin-top:8px;">Drag and zoom the map as needed.</span>
                        </div>
                    </div>
                </section>
                <section id="history" class="tab-content" aria-hidden="true">
                    <img src="Image/logo.jpg" alt="ALACDANS logo" class="logo">
                    <h2>History</h2>
                    <div class="history-huge-box">
                        <div style="display: flex; gap: 18px; align-items: center; margin-bottom: 18px; justify-content:center;">
                            <button id="history-dashboard-btn" class="big-search-btn" style="background:#4caf50; color:#fff; min-width:140px; box-shadow:0 2px 8px rgba(76,175,80,0.08);">Dashboard</button>
                            <button id="history-monitoring-btn" class="big-search-btn" style="background:#2196f3; color:#fff; min-width:140px; box-shadow:0 2px 8px rgba(33,150,243,0.08);">Monitoring System</button>
                            <button id="history-refresh-btn" class="big-search-btn" style="background:#ff9800; color:#fff; min-width:120px; box-shadow:0 2px 8px rgba(255,152,0,0.08); font-size:1em; margin-left:18px;">⟳ Refresh</button>
                        </div>
                        <div id="history-graph-container" style="width:100%; min-height:420px; background:#fff; border-radius:14px; box-shadow:0 2px 12px rgba(0,0,0,0.04); display:flex; align-items:center; justify-content:center; padding:32px 18px; box-sizing:border-box;">
                            <canvas id="history-graph" width="900" height="380" style="max-width:100%; max-height:100%; background:#fff; border-radius:12px; box-shadow:0 1px 8px rgba(0,0,0,0.07);"></canvas>
                            <div id="history-dashboard-log"></div>
                            <div id="history-monitoring-log" style="display:none;"></div>
                        </div>
                        <!-- Project Description and Contact Info -->
                        <div style="padding: 20px 24px; border-top: 1.5px solid #e0c9b0; background: #fffbe8; border-radius:0 0 18px 18px;">
                            <div style="font-size: 1.08em; color: #333; text-align: center; margin-bottom: 8px;">
                                <b>Tip:</b> The Dashboard history shows <b>5-minute average</b> sensor readings with timestamps.<br>
                                The Monitoring System history shows event logs with timestamps.
                            </div>
                        </div>
                    </div>
                </section>
                <section id="monitoring-detail" class="tab-content" aria-hidden="true">
                    <img src="Image/logo.jpg" alt="ALACDANS logo" class="logo">
                    <h2>Monitoring System</h2>
                    <div class="monitoring-huge-box" style="display: flex; gap: 24px; height: 480px;">
                        <!-- Camera Controls Box (identical to monitoring) -->
                        <div style="flex:1; background:#fff; border-radius:18px; box-shadow:0 2px 12px rgba(0,0,0,0.07); border:1.5px solid #b0b8c9; display:flex; flex-direction:column; align-items:center; justify-content:center; margin-right:12px;">
                            <h3 style="margin-bottom: 18px; color:#222;">Camera Controls</h3>
                            <div class="monitor-controls" style="display:flex; flex-direction:column; align-items:center;">
                                <button class="pause-detail-btn" style="padding:12px 32px; border-radius:18px; background:#bbb; color:#333; border:none; font-size:1.1em; margin-bottom:16px; cursor:pointer;">Pause</button>
                                <button class="stop-detail-btn" style="padding:12px 32px; border-radius:18px; background:#b00; color:#fff; border:none; font-size:1.1em; cursor:pointer;">Stop</button>
                            </div>
                            <button class="resume-detail-btn" style="padding:12px 32px; border-radius:18px; background:green; color:#fff; border:none; font-size:1.1em; margin-top:8px; display:none; cursor:pointer;">Resume</button>
                        </div>
                        <!-- Google Map Box (identical to monitoring) -->
                        <div style="flex:2; background:#e0eaff; border-radius:18px; box-shadow:0 2px 12px rgba(0,0,0,0.07); border:1.5px solid #b0b8c9; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                            <h3 style="margin-bottom: 12px; color:#222;">Location Map</h3>
                            <div style="width:95%; height:340px; border-radius:12px; overflow:hidden; box-shadow:0 1px 8px rgba(0,0,0,0.10);">
                                <!-- Google Map iframe placeholder -->
                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3874.007234234234!2d121.045!3d14.579!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTTCsDM0JzQ0LjAiTiAxMjHCsDAyJzQyLjAiRQ!5e0!3m2!1sen!2sph!4v1660000000000!5m2!1sen!2sph" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                            </div>
                            <span style="font-size:0.95em; color:#555; margin-top:8px;">Drag and zoom the map as needed.</span>
                        </div>
                    </div>
                </section>
                <section id="about" class="tab-content" aria-hidden="true">
                    <img src="Image/logo.jpg" alt="ALACDANS logo" class="logo">
                    <h2>About</h2>
                    <div style="font-size: 1.08em; color: #333; text-align: justify; margin-bottom: 18px; margin-top: 18px;">
                        Flooding in urban areas of the Philippines remains a persistent problem, largely caused by heavy rainfall, clogged drainage systems, and improper waste disposal. To address this, the study introduces <b>ALACDANS: Automated Live Alert and Clogged Detection for Abnormalities in Urban Sewers</b>, a low-cost microcontroller-based drainage monitoring system. The device integrates sensors such as the JSN-SR04T ultrasonic probe and VL53L0X Time-of-Flight sensor with an ESP32 Cam to detect water levels, identify debris, and provide real-time visual confirmation. Data is transmitted to a web-based monitoring platform and stored securely in the cloud, while alerts are automatically sent to stakeholders through email or SMS. The system aims to improve flood preparedness by offering timely alerts, accurate water level tracking, and clog detection. Through performance benchmarking, correlation analysis, and usability surveys, the study evaluates the system’s effectiveness compared to existing monitoring methods. The expected outcome is a sustainable and reliable prototype capable of minimizing flood risks, ensuring public safety, and supporting local government efforts in drainage management.
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 8px; font-size: 1em; color: #222; margin-bottom: 18px;">
                        <span style="display: flex; align-items: center; gap: 6px;">
                            <span style="font-size: 1.2em;">&copy; 2025</span>
                            <span>ALACDANS Project</span>
                        </span>
                        <span>
                            <b>Email:</b> 
                            <a href="mailto:khs.cadylorhaine.lao@kapitolyohighschool.com" style="color: #006400; text-decoration: underline;" target="_blank">khs.cadylorhaine.lao@kapitolyohighschool.com</a>
                        </span>
                        <span>
                            <b>Mobile:</b> 
                            <a href="sms:09398250606" style="color: #006400; text-decoration: underline;" target="_blank">09398250606</a>
                        </span>
                    </div>
                </section>
            </div>
        </div>
        <footer class="footer" aria-hidden="true">
            <span style="display:inline-block; margin-right:18px;">&copy; 2025 ALACDANS Project</span>
            <a href="#" style="color:#fff; text-decoration:underline; margin-right:18px;">Privacy policy</a>
            <a href="#" style="color:#fff; text-decoration:underline;">Terms of use</a>
        </footer>
    </div>
    <script>
(function(){
  // Utility: safe query
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  // --- Tab switching & search/highlight helpers ---
  const links = $$('.sidebar a');
  const tabs = $$('.tab-content');

  function removeHighlights() {
    document.querySelectorAll('.tab-content .highlight-search').forEach(el => {
      el.outerHTML = el.innerHTML;
    });
  }

  function showTab(id, clickedLink) {
    tabs.forEach(t => {
      const active = t.id === id;
      t.classList.toggle('active', active);
      t.setAttribute('aria-hidden', String(!active));
    });
    if (clickedLink) {
      links.forEach(l => l.classList.toggle('active', l === clickedLink));
    }
    // When monitoring tab opens, load latest image
    if (id === 'monitoring') {
      loadLatestImage();
    }
  }

  links.forEach(link => {
    link.addEventListener('click', function(e){
      e.preventDefault();
      const target = this.dataset.target;
      if (!target) return;
      showTab(target, this);
      removeHighlights();
    });
  });

  // Show initial tab
  const initial = document.querySelector('.sidebar a.active') || links[0];
  if (initial) showTab(initial.dataset.target, initial);

  // --- Header search (Ctrl+F style) ---
  const searchInput = $('#header-search');
  const searchResults = $('#header-search-results');
  const searchExit = $('#header-search-exit');
  const sidebarTabs = [
    { id: 'home', label: 'Home' },
    { id: 'dashboard', label: 'Dashboard' },
    { id: 'monitoring', label: 'Monitoring System' },
    { id: 'history', label: 'History' },
    { id: 'about', label: 'About' }
  ];

  function highlightWord(tabId, word) {
    removeHighlights();
    if (!word) return;
    const tab = document.getElementById(tabId);
    if (!tab) return;
    const walker = document.createTreeWalker(tab, NodeFilter.SHOW_TEXT, null, false);
    let node;
    const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
    while ((node = walker.nextNode())) {
      if (node.parentNode && node.nodeValue.trim() && regex.test(node.nodeValue)) {
        const span = document.createElement('span');
        span.innerHTML = node.nodeValue.replace(regex, match => `<mark class='highlight-search' style='background:yellow;color:#222;'>${match}</mark>`);
        node.parentNode.replaceChild(span, node);
      }
    }
  }

  function showSearchResults(word) {
    searchResults.innerHTML = '';
    if (!word || word.length < 1) {
      searchResults.style.display = 'none';
      searchExit.style.display = 'none';
      removeHighlights();
      return;
    }
    let found = false;
    sidebarTabs.forEach(tab => {
      const tabEl = document.getElementById(tab.id);
      if (tabEl && tabEl.textContent.toLowerCase().includes(word.toLowerCase())) {
        found = true;
        const div = document.createElement('div');
        div.textContent = `Found in: ${tab.label}`;
        div.style.padding = '10px 16px';
        div.style.cursor = 'pointer';
        div.style.borderBottom = '1px solid #eee';
        div.addEventListener('click', function() {
          const sidebarLink = Array.from(links).find(l => l.dataset.target === tab.id);
          if (sidebarLink) sidebarLink.click();
          highlightWord(tab.id, word);
          searchResults.style.display = 'none';
          searchExit.style.display = '';
        });
        searchResults.appendChild(div);
      }
    });
    if (!found) {
      const div = document.createElement('div');
      div.textContent = 'No matches found.';
      div.style.padding = '10px 16px';
      searchResults.appendChild(div);
    }
    searchResults.style.display = 'block';
    searchExit.style.display = '';
  }

  if (searchInput) {
    searchInput.addEventListener('input', function() {
      showSearchResults(this.value.trim());
    });
    searchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        searchResults.style.display = 'none';
        searchExit.style.display = 'none';
        searchInput.value = '';
        removeHighlights();
      }
    });
  }
  if (searchExit) {
    searchExit.addEventListener('click', function() {
      searchResults.style.display = 'none';
      searchExit.style.display = 'none';
      searchInput.value = '';
      removeHighlights();
    });
  }

  // --- Login logic ---
  const loginForm = $('#login-form');
  if (loginForm) {
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const user = $('#username').value.trim();
      const pass = $('#password').value.trim();
      const error = $('#login-error');
      error.style.display = 'none';
      if (user === 'AS' && pass === 'ALACDANS') {
        $('#login-interface').style.display = 'none';
        $('#main-interface').style.display = '';
      } else {
        error.style.display = 'block';
      }
    });
    $('#username').addEventListener('input', () => $('#login-error').style.display = 'none');
    $('#password').addEventListener('input', () => $('#login-error').style.display = 'none');
  }

  // --- Avatar menu ---
  const avatar = $('#avatar-account');
  const menu = $('#account-menu');
  let menuOpen = false;
  function closeMenu(e) {
    if (!menu.contains(e.target) && e.target !== avatar) {
      menu.style.display = 'none';
      menuOpen = false;
      document.removeEventListener('mousedown', closeMenu);
    }
  }
  if (avatar) {
    avatar.addEventListener('click', function(e){
      e.stopPropagation();
      menu.style.display = menuOpen ? 'none' : 'block';
      menuOpen = !menuOpen;
      if (menuOpen) document.addEventListener('mousedown', closeMenu);
    });
    avatar.addEventListener('keydown', function(e){
      if (e.key === 'Enter' || e.key === ' ') avatar.click();
    });
  }
  const signoutBtn = $('#signout-btn');
  if (signoutBtn) {
    signoutBtn.addEventListener('click', function() {
      $('#main-interface').style.display = 'none';
      $('#login-interface').style.display = '';
      if (menu) menu.style.display = 'none';
      menuOpen = false;
      $('#username').value = '';
      $('#password').value = '';
    });
  }

  // --- Gauges (kept simple) ---
  function setGaugeValue(gaugeBar, value, min, max) {
    value = Math.max(min, Math.min(max, value));
    const percent = (value - min) / (max - min || 1);
    const startX = 20, startY = 90, r = 70;
    const angle = Math.PI * (1 - percent);
    const x = startX + r * Math.cos(angle);
    const y = startY - r * Math.sin(angle);
    const d = `M${startX},${startY} A${r},${r} 0 0,1 ${x},${y}`;
    if (gaugeBar) gaugeBar.setAttribute('d', d);
  }

  async function loadGauges() {
    try {
      const FIREBASE_URL = 'https://alacdans-dde5a-default-rtdb.asia-southeast1.firebasedatabase.app/sensor_readings.json?auth=AIzaSyBmnPqHuE35Cly5pcdoAKiF95GI4o3R5QU';
      const LEVELS_URL = 'https://alacdans-dde5a-default-rtdb.asia-southeast1.firebasedatabase.app/sensor_levels.json?auth=AIzaSyBmnPqHuE35Cly5pcdoAKiF95GI4o3R5QU';
      const [readingsRes, levelsRes] = await Promise.all([ fetch(FIREBASE_URL), fetch(LEVELS_URL) ]);
      const data = await readingsRes.json();
      const levels = await levelsRes.json();
      const minVal = 0, maxVal = 400;

      // Lidar
      const lidarValue = data && data.Lidar_readings && typeof data.Lidar_readings.value === 'number' ? data.Lidar_readings.value : 0;
      const lidarGaugeValue = $('#lidar-gauge-value');
      const lidarGaugeBar = $('#lidar-gauge-bar');
      if (lidarGaugeValue) lidarGaugeValue.textContent = lidarValue ? `${lidarValue} cm` : '-- cm';
      setGaugeValue(lidarGaugeBar, lidarValue, minVal, maxVal);

      // Ultrasonic
      const ultrasonicValue = data && data.Ultrasonic_readings && typeof data.Ultrasonic_readings.value === 'number' ? data.Ultrasonic_readings.value : 0;
      const ultrasonicGaugeValue = $('#ultrasonic-gauge-value');
      const ultrasonicGaugeBar = $('#ultrasonic-gauge-bar');
      if (ultrasonicGaugeValue) ultrasonicGaugeValue.textContent = ultrasonicValue ? `${ultrasonicValue} cm` : '-- cm';
      setGaugeValue(ultrasonicGaugeBar, ultrasonicValue, minVal, maxVal);

      // Ultrasonic level
      let ultrasonicLevel = '--';
      if (levels) {
        if (typeof levels.Ultrasonic_readings === 'string' && levels.Ultrasonic_readings.trim()) ultrasonicLevel = levels.Ultrasonic_readings;
        else if (typeof levels.Binary_Ultrasonic_Level === 'string' && levels.Binary_Ultrasonic_Level.trim()) ultrasonicLevel = levels.Binary_Ultrasonic_Level;
      }
      if ((ultrasonicLevel === '--' || ultrasonicLevel === '') && data && data.Ultrasonic_readings && typeof data.Ultrasonic_readings.level === 'string') {
        ultrasonicLevel = data.Ultrasonic_readings.level;
      }
      const ultrasonicLevelIndicator = $('#ultrasonic-level-indicator');
      if (ultrasonicLevelIndicator) {
        ultrasonicLevelIndicator.textContent = `Level: ${ultrasonicLevel}`;
        let bg = '#e8f0fb', color = '#0d47a1';
        const lvl = (ultrasonicLevel || '').toString();
        if (lvl.toUpperCase().includes('NO_ECHO')) { bg = '#ffeaea'; color = '#d32f2f'; }
        else if (lvl.includes('2')) { bg = '#fffbe0'; color = '#bfa100'; }
        else if (lvl.includes('1')) { bg = '#e3f0ff'; color = '#1976d2'; }
        ultrasonicLevelIndicator.style.background = bg;
        ultrasonicLevelIndicator.style.color = color;
      }

    } catch (err) {
      console.error('Error loading gauge readings:', err);
    }
  }

  // initial and periodic
  document.addEventListener('DOMContentLoaded', function(){ loadGauges(); setInterval(loadGauges, 5000); });

  // --- History fetch/render (single clean implementation) ---
  async function fetchHistoryAverages() {
    const DASH_HISTORY_URL = 'https://alacdans-default-rtdb.asia-southeast1.firebasedatabase.app/history_dashboard.json?auth=E28HOd7g0PNLT3ZyiO9ED4f3PVrZ0PZsus69WgqF';
    const MON_HISTORY_URL = 'https://alacdans-default-rtdb.asia-southeast1.firebasedatabase.app/history_monitoring.json?auth=E28HOd7g0PNLT3ZyiO9ED4f3PVrZ0PZsus69WgqF';
    try {
      const [dashRes, monRes] = await Promise.all([ fetch(DASH_HISTORY_URL), fetch(MON_HISTORY_URL) ]);
      const dashData = await dashRes.json() || [];
      const monData = await monRes.json() || [];
      renderDashboardHistory(dashData);
      renderMonitoringHistory(monData);
    } catch (err) {
      console.error('Error fetching history:', err);
    }
  }

  function formatDate(date) {
    const pad = n => n < 10 ? '0' + n : n;
    return pad(date.getDate()) + '/' + pad(date.getMonth() + 1) + '/' + date.getFullYear() +
      ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes()) + ':' + pad(date.getSeconds());
  }

  function renderDashboardHistory(data) {
    const log = $('#history-dashboard-log');
    if (!log) return;
    log.innerHTML = '';
    if (!data || Object.keys(data).length === 0) {
      log.innerHTML = '<div class="history-entry">No dashboard history available.</div>';
      return;
    }
    const arr = Array.isArray(data) ? data : Object.values(data);
    arr.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0));
    arr.forEach(entry => {
      const date = entry.timestamp ? new Date(entry.timestamp) : null;
      const timeStr = date ? formatDate(date) : 'Unknown time';
      const ub = entry.ultrasonic_binary_level || entry.ultrasonicBinaryLevel || entry.ultrasonic_level || '';
      const ubHtml = ub ? ` <span style="color:#bfa100; font-weight:600; margin-left:8px;">(${ub})</span>` : '';
      log.innerHTML += `<div class="history-entry" style="border-left:5px solid #4caf50;">
        <div style="font-size:1.08em; font-weight:600; color:#222; margin-bottom:2px;">${timeStr}</div>
        <div style="display:flex; gap:18px; align-items:center;">
          <span style="color:#388e3c; font-weight:500;">Lidar Avg: <b>${entry.lidar_avg ?? '--'}</b> cm</span>
          <span style="color:#1976d2; font-weight:500;">Ultrasonic Avg: <b>${entry.ultrasonic_avg ?? '--'}</b> cm${ubHtml}</span>
        </div>
        <div style="font-size:0.98em; color:#888; margin-top:2px;">(5-minute average)</div>
      </div>`;
    });
  }

  function renderMonitoringHistory(data) {
    const log = $('#history-monitoring-log');
    if (!log) return;
    log.innerHTML = '';
    if (!data || Object.keys(data).length === 0) {
      log.innerHTML = '<div class="history-entry">No monitoring history available.</div>';
      return;
    }
    const arr = Array.isArray(data) ? data : Object.values(data);
    arr.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0));
    arr.forEach(entry => {
      const date = entry.timestamp ? new Date(entry.timestamp) : null;
      const timeStr = date ? formatDate(date) : 'Unknown time';
      log.innerHTML += `<div class="history-entry"><b>${timeStr}</b><br>${entry.event ?? ''}</div>`;
    });
  }

  document.addEventListener('DOMContentLoaded', function(){ fetchHistoryAverages(); setInterval(fetchHistoryAverages, 5*60*1000); });

  // --- Monitoring image loader (no button, auto-load when tab shown) ---
  const imageEl = document.getElementById('latest-firebase-image');
  const imageStatus = document.getElementById('image-status');
  const cameraBox = document.getElementById('camera-refresh-box');

  async function loadLatestImage() {
    if (!imageEl || !imageStatus) return;
    imageStatus.textContent = 'Loading image...';
    try {
      const FIREBASE_IMAGES_URL = 'https://alacdans-dde5a-default-rtdb.asia-southeast1.firebasedatabase.app/images.json?auth=AIzaSyBmnPqHuE35Cly5pcdoAKiF95GI4o3R5QU';
      const res = await fetch(FIREBASE_IMAGES_URL);
      const data = await res.json();
      let base64 = '';
      if (data && typeof data === 'object') {
        // Get all timestamp keys, sort descending
        const timestampKeys = Object.keys(data).sort().reverse();
        for (const tsKey of timestampKeys) {
          const entryGroup = data[tsKey];
          if (entryGroup && typeof entryGroup === 'object') {
            // Get the first child (should be only one)
            const childKeys = Object.keys(entryGroup);
            if (childKeys.length > 0) {
              const imgObj = entryGroup[childKeys[0]];
              if (imgObj && imgObj.image) {
                base64 = imgObj.image;
                break;
              }
            }
          }
        }
      }
      if (base64) {
        imageEl.src = 'data:image/jpeg;base64,' + base64;
        imageEl.style.display = '';
        imageStatus.textContent = '';
      } else {
        imageEl.style.display = 'none';
        imageStatus.textContent = 'No image found. Click to retry.';
      }
    } catch (err) {
      imageEl.style.display = 'none';
      imageStatus.textContent = 'Error loading image. Click to retry.';
    }
  }

  // Make the whole camera box clickable for refresh
  if (cameraBox) {
    cameraBox.addEventListener('click', function(ev) {
      ev.preventDefault();
      imageStatus.textContent = 'Refreshing...';
      loadLatestImage();
    });
  }

  // Attach loadLatestImage to monitoring link(s) in case of multiple links
  $$('.sidebar a[data-target="monitoring"]').forEach(a => {
    a.addEventListener('click', function(){ /* handled by showTab which calls loadLatestImage */ });
  });

  // Also load on page load if monitoring tab active
  document.addEventListener('DOMContentLoaded', function(){
    if ($('#monitoring') && $('#monitoring').classList.contains('active')) loadLatestImage();
  });

  // --- Home search mapping (keeps original behavior) ---
  const searchBtn = $('#search-btn');
  if (searchBtn) {
    searchBtn.addEventListener('click', function () {
      const city = $('#city-select').value;
      const place = $('#place-select').value;
      if (!city || !place) { alert('Please select both a city and a place.'); return; }
      const mapCoords = {
        mandaluyong: {
          'addition-hills': { lat: 14.5896, lng: 121.0272 },
          'plainview': { lat: 14.5792, lng: 121.0347 },
          'wack-wack': { lat: 14.6011, lng: 121.0422 },
          'barangka': { lat: 14.5797, lng: 121.0492 },
          'highway-hills': { lat: 14.5832, lng: 121.0497 },
          'hulo': { lat: 14.5837, lng: 121.0412 },
          'malamig': { lat: 14.5732, lng: 121.0342 },
          'namayan': { lat: 14.5702, lng: 121.0302 },
          'new-zaniga': { lat: 14.5742, lng: 121.0352 },
          'old-zaniga': { lat: 14.5722, lng: 121.0332 },
          'pleasant-hills': { lat: 14.5772, lng: 121.0372 },
          'vergara': { lat: 14.5752, lng: 121.0312 }
        },
        pasig: {
          'kapitolyo': { lat: 14.5611, lng: 121.0583 },
          'pineda': { lat: 14.5617, lng: 121.0631 },
          'bagong-ilog': { lat: 14.5619, lng: 121.0701 },
          'san-antonio': { lat: 14.5792, lng: 121.0637 },
          'san-jose': { lat: 14.5732, lng: 121.0702 },
          'caniogan': { lat: 14.5702, lng: 121.0652 },
          'maybunga': { lat: 14.5762, lng: 121.0802 },
          'manggahan': { lat: 14.5902, lng: 121.0852 },
          'rosario': { lat: 14.5952, lng: 121.0902 },
          'saguday': { lat: 14.6002, lng: 121.0952 },
          'ugong': { lat: 14.6052, lng: 121.1002 },
          'orambo': { lat: 14.6102, lng: 121.1052 }
        }
      };
      const coords = mapCoords[city] && mapCoords[city][place];
      if (!coords) { alert('Location not found on map.'); return; }
      const monitoringTab = links.find(l => l.dataset.target === 'monitoring');
      if (monitoringTab) monitoringTab.click();
      setTimeout(function() {
        const monitoringSection = $('#monitoring');
        if (monitoringSection) {
          const iframe = monitoringSection.querySelector('iframe');
          if (iframe) iframe.src = `https://www.google.com/maps?q=${coords.lat},${coords.lng}&z=16&output=embed`;
        }
      }, 200);
    });
  }

})(); // IIFE end
    </script>
</body>
</html>
